# 比特币（5）匿名性

## 比特币的匿名性

### 匿名性对比

匿名性指的是区块链账户(节点)没有直接对应的身份信息。可以类比与未实名认证的昵称。

在货币交易中，匿名性最好的当然是纸币。

如果是银行允许使用化名来进行存取款，那么银行的匿名性是要优于区块链的。因为区块链上，所有节点都可以查到某个账户的交易记录，而只有银行的工作人员可以查到化名账户的交易记录。

### 如何破坏比特币的匿名性

#### 不同账号关联到一个人身上

一些操作可以让创造的不同账户被关联到一个人（或者一个机构）身上。

我们假设现在A向B转账（A，B都有若干个账户）

1. 输入地址的关联：假设有一笔交易的input有几个地址的签名，则这几个地址很可能被A所控制。

2. 同理，一笔交易的输出到几个账户，这几个账户也很有可能被B控制。

3. 在输出的账户中，可能存在一个A的账户，用来承担接收找零的作用。我们可以通过交易的关系来将这个账户找出来。假设现在inputs：addr1—4币，addr2—5币   outputs：addr3—6币  addr4—3币。则addr4可能是A的账户，而这笔交易实际上需要支付6币（因为如果需要3币的话使用一个账户转账就行）。

4. 在实际交易中，可能有些人为了掩盖自己控制账户之间的关联性，在一笔交易中添加没必要的账户参与。

5. 在常用的比特币钱包中，一般不会生成不必要的地址，因此搞懂每个钱包的转账逻辑，就可以找到区块链中大部分账户的关联性。

#### 账号和现实世界链接造成身份关联

1. 资金的转入与转出，与比特币的兑换
2. 使用比特币交易，交易信息和现实活动的同时进行
3. 大额资金链的跟踪

#### 区块链的匿名性只在一定程度上起作用

区块链的匿名性无法保证你使用区块链进行交易不被发现，但是在一定程度上可以保护你的个人隐私。

比如，你不想让你身边的人知道你的资产，那么区块链可以实现。

但是如果你想使用区块链来维持一个黑市的资金流量，从而躲避政府的监管，那就大可不必了，因为迟早被抓到。

### 如何保护自己的隐私？

说了那么多，我们现在对于区块链的匿名性有了了解，那么怎么做可以加强这种匿名性？

#### 网络层

在网络层上，有一种常见的技术——多路径转发。这种技术的一个应用实例——TOR（洋葱网络）

TOR（The Onion Router）是一种匿名通信网络，也被称为洋葱网络。它通过将数据包经过多层加密和多次转发，使得数据传输变得难以被追踪和监视，从而保护用户的隐私和匿名性。

在TOR网络中，数据包会经过一系列的中间节点，每个节点都只知道前一跳和后一跳节点的信息，而不知道整个终端到终端的路径。因此，即使某个节点被监控或攻击，也不会泄漏发送者或接收者的真实信息。

TOR网络被广泛应用于维护用户隐私、规避网络审查和监视、访问被封锁的网站等领域。但同时也存在一些安全风险，如存在恶意节点监视流量、降低网络性能等问题。因此，在使用TOR网络时，用户需要注意保护自己的隐私和安全。

#### 应用层

采用的常见手段叫做coin_mixing

1. 有负责coin_mixing的网站，但是这些网站是匿名的，不是很可靠
2. 一些在线钱包具有的特性
3. 交易所天然具有coin_mixing的性质，前提是它不把交易记录公布

### 为什么区块链的匿名性这么差？

区块链具有不可篡改性和溯源性，这两个性质都是匿名者的天敌

1. 一旦一次交易暴露，这种不可篡改的数据就会留下马脚
2. 一旦一个账户暴露，资金来源和相关帐户就可能被一锅端

## 零知识证明

零知识证明是指一方(证明者)向另一方(验证者)证明一个陈述是正确的，而**无需透露除该陈述是正确的外的任何信息**。

我们之前谈到的预测股票就是一个例子。

### 同态隐藏

同态隐藏是零知识证明的数学基础

#### 同态隐藏的三个性质：

1. 如果x,y不同，那么它们的加密函数值E(x)和E(y)也不相同。说明加密后结果相等，则输入结果相等（逆否命题）。  **不会出现碰撞**

2. 给定E(x)的值，很难反推出x的值。  **单向性**

3. 给定E(x)和E(y)的值，我们可以很容易地计算出某些关于x,y的加密函数值。**同态运算**
   -同态加法:通过E(x)和E(y)计算出E(x+y)的值
   -同态乘法:通过E(x)和E(y)计算出E(xy)的值
   -扩展到多项式

#### 例子：

##### 简单的零知识证明

Alice想要向Bob证明她知道一组数x和y使得x+y=7同时不让Bob知道x和y的具体数值。

只需得到x y进行同态运算的结果之和 == 7进行同态运算的结果

##### 盲签方法

1. 银行向A发布货币，货币编号由A自己生成
2. 用户A提供SerialNum，银行在不知道SerialNum的情况下返回签名Token，减少A的存款
3. 用户A把SerialNum和Token交给B完成交易
4. 用户B拿SerialNum和Token给银行验证，银行验证通过，增加B的存款
5. 银行无法把A和B联系起来。
6. 中心化

##### 零币和零钞

1. 零币和零钞在协议层就融合了匿名化处理，其匿名属性来自密码学保证。
2. 零币(zerocoin )系统中存在基础币和零币，通过基础币和零币的来回转换，消除旧地址和新地址的关联性，其原理类似于混币服务。（就像之前脚本那次谈到的毁币脚本，毁掉比特币兑换小币就是这样的）
3. 零钞(zerocash)系统使用zK-SNARKs协议，不依赖一种基础币，区块链中只记录交易的存在性和矿工用来验证系统正常运行所需要关键属性的证明。区块链上既不显示交易地址也不显示交易金额，所有交易通过零知识验证的方式进行。

零知识证明的相关知识之后会有介绍

## 关于比特币的思考

### 哈希指针

指针是什么？指针是指向内存地址的一个变量。那么指针在另外一台计算机上就没有意义了（因为人家的那块地址不一定存的什么）。哈希指针又为什么在网络上传播后又能使用的呢？

原因就是，所谓哈希指针只有哈希，没有指针！

**那么怎么通过哈希值来找到区块呢？**

全节点一般将区块存储在一个（key，value）数据库中。key—哈希值，value—内容

常用的存储数据库是levelDB，只要掌握了最后一个区块的哈希值，在levelDB里面找到对应的value（区块内容），再根据内容里Block_Header里的前一个区块的哈希，如法炮制这样的操作，就可以遍历整个区块链。

### 区块恋

对于多个人的共享账户，如果采用截断私钥的方法
1. 拥有部分私钥的人破解账户的难度会大大下降
2. 如果但凡一方的私钥丢了，这个账户就作废了
3. 另外，这些分手后的死钱会存在UTXO里面，全节点真的会谢
4. by the way 有没有一种可能，钟本超和他女友分手了（dog）

因此，共享账户应该采取的是多重签名的方法（脚本那篇谈到过）。

### 分布式共识

理论上证明了，分布式系统无法达成共识。那么比特币如何实现呢？

比特币其实没有达到真正意义上的共识，无论是分叉攻击还是最长的合法链，都是大多数人的共识，而不是完全的共识。

这也告诉我们，理论上不能实现的事情，在现实中可以打破这个情景，将其实现！

比如：分布式的异步是无法判断其状态的（宕机还是网络延时），但是在实际中，你只需要给那边的人打个电话询问一下就好了（打破了 异步 的局限模型）

### 比特币的稀缺性

加密货币想吸引人们来挖矿，要么增加挖矿收益，要么降低挖矿成本！

因此，在现在挖矿难度加大，挖矿收币减少的时候。比特币的升值，使得更多人愿意来挖矿。

但是，从金融上来看，数额一定的东西不适合用来当作货币，因为这样的话，以前拥有的人会持续拥有，现在没有的人以后也没希望，比如房地产。而适当的通胀，一方面是适应了社会生产力提升，另一方面也是推动社会进步发展的一个动力。

### 量子计算

很多人担心，量子计算的强大算力会不会导致基于密码学的加密货币直接崩溃

首先，量子计算的技术距离成熟还有很长时间，等到技术成熟时，比特币是否存在就是个问题了。

其次，量子计算的影响不是针对加密货币的，而是针对整个电商、通讯、金融系统的。等到量子计算技术成熟的时候，要首先担心的可能真不是区块链

再者，随着量子解密的出现，量子加密也会随之到来

最后，我们谈谈区块链为什么能够防范。

1. 你公布的账户地址不是公钥，而是公钥的哈希值，哈希不是加密，是截取性运算——也就是说哈希值根本不是包含原文的全部信息，根本无法按照哈希值来还原文件。
2. 公钥暴露的时候只有转出的时候，在这时，如果想要偷走你的钱，需要首先计算出你的私钥，生成签名，并且抢先发布这个偷钱交易。这基本上是不可能的
3. 为了保护你免受量子计算的攻击，每个账户只转出一次（全款转出）是最好的方法 
